# cert-manager ClusterIssuer for Let's Encrypt
# Prerequisites: cert-manager must be installed
#   helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set installCRDs=true
#
# Variables:
#   {{ACME_EMAIL}}  - Email for Let's Encrypt notifications (e.g., admin@example.com)

---
# Production Issuer - Use for real domains with valid certificates
# Rate limit: 50 certificates per registered domain per week
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # Production ACME server
    server: https://acme-v02.api.letsencrypt.org/directory
    email: {{ACME_EMAIL}}
    privateKeySecretRef:
      name: letsencrypt-prod-key
    solvers:
      # HTTP-01 challenge via ingress
      - http01:
          ingress:
            class: nginx

---
# Staging Issuer - Use for testing (no rate limits, untrusted certs)
# Use this first to verify your setup works before switching to prod
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    # Staging ACME server (fake certs, no rate limits)
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: {{ACME_EMAIL}}
    privateKeySecretRef:
      name: letsencrypt-staging-key
    solvers:
      - http01:
          ingress:
            class: nginx

---
# Usage in Ingress:
#
# For staging (test first):
#   annotations:
#     cert-manager.io/cluster-issuer: letsencrypt-staging
#
# For production (after staging works):
#   annotations:
#     cert-manager.io/cluster-issuer: letsencrypt-prod
#
# Verification:
#   kubectl get certificate -n <namespace>
#   kubectl describe certificate <name> -n <namespace>
#   kubectl get certificaterequest -n <namespace>
#   kubectl get order -n <namespace>
#   kubectl get challenge -n <namespace>
