# Default values for todo-app Helm chart (Minikube local dev)

global:
  imagePullPolicy: IfNotPresent
  # imageTag overrides all service image tags — set by CI via --set global.imageTag=sha-xxxx
  imageTag: "latest"
  # imagePullSecrets for private registries (GHCR in cloud environments)
  imagePullSecrets: []
  # Example for cloud:
  # imagePullSecrets:
  #   - name: ghcr-pull-secret

# --- Frontend (Next.js) ---
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-frontend
    tag: "latest"
  service:
    type: NodePort
    port: 3000
    nodePort: 30080
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# --- Backend (FastAPI) ---
backend:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-backend
    tag: "latest"
  service:
    type: ClusterIP
    port: 8000
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# --- MCP Server (FastMCP) ---
mcp:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-mcp
    tag: "latest"
  service:
    type: ClusterIP
    port: 8001
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 256Mi

# --- Configuration (non-sensitive → ConfigMap) ---
config:
  logLevel: "info"
  debug: "false"
  betterAuthUrl: "http://todo-app-frontend:3000"
  corsOrigins: "http://localhost:30080"
  mcpServerUrl: "http://todo-app-mcp:8001/mcp"
  mcpServerPort: "8001"
  backendUrl: "http://todo-app-backend:8000"
  openaiBaseUrl: "https://openrouter.ai/api/v1"

# --- Secrets (sensitive → K8s Secret) ---
# Two modes:
#   Local dev: set values below — chart creates a K8s Secret from them
#   Cloud:     set existingSecretName: "app-secrets" — chart skips creation,
#              deployments reference the pre-created secret by that name
secrets:
  existingSecretName: ""   # If set, skip chart-managed secret creation
  databaseUrl: ""
  betterAuthSecret: ""
  openaiApiKey: ""
  frontendDatabaseUrl: ""

# --- Notification Service ---
notification:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-notification
    tag: "latest"
  service:
    type: ClusterIP
    port: 8002
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 256Mi

# --- SSE Gateway ---
sseGateway:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-sse-gateway
    tag: "latest"
  service:
    type: ClusterIP
    port: 8003
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 256Mi

# --- Redpanda (Kafka-compatible broker) ---
redpanda:
  enabled: true
  image:
    repository: docker.redpanda.com/redpandadata/redpanda
    tag: "v24.1.1"
  storage:
    size: 2Gi
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: "1"
      memory: 256Mi

# --- Redis (Dapr state store) ---
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

# --- HPA (Horizontal Pod Autoscaler) ---
# Set hpa.enabled: true in environment values files to activate HPA for each service.
# Per-service hpa settings (minReplicas, maxReplicas, cpuTargetPercent) live in
# values-staging.yaml and values-production.yaml.
hpa:
  enabled: false

# --- Monitoring (ServiceMonitors + alerting rules for kube-prometheus-stack) ---
monitoring:
  enabled: false

# --- Dapr Configuration ---
dapr:
  enabled: true
  pubsub:
    # authType: "none" for local dev (in-cluster Redpanda, no auth)
    # authType: "scram" for cloud (Redpanda Cloud, credentials from app-secrets)
    brokers: "todo-app-redpanda-0.todo-app-redpanda:9093"
    authType: "none"
    disableTls: "true"
  statestore:
    redisHost: "todo-app-redis:6379"
  cronSchedule: "@every 5m"
  mtls:
    enabled: true
  tracing:
    samplingRate: "1"
    zipkin:
      # enabled: false disables Zipkin export (use when no Jaeger/Zipkin is installed)
      enabled: false
    endpointAddress: ""  # Set to Jaeger/Zipkin collector URL if zipkin.enabled is true
  metrics:
    enabled: true

# --- Ingress (enabled by default for local Minikube — requires minikube addons enable ingress)
# Access at http://todo.local after adding to /etc/hosts: $(minikube ip) todo.local
ingress:
  enabled: true
  className: nginx
  host: todo.local
